import{r as te,f as $e,s as Ae,c as M,n as O,t as F,h as X,B as Ne,j as Q,m as Y,a as Z,k as ze,b as ge,l as Ee,o as Le,p as qe,q as Fe,v as Me,x as ce,y as Ue,z as ue,A as he,C as de,e as ae,u as ne,d as De,D as He,w as le,E as We,F as je,I as Ze,G as Ge,i as Ke}from"./index-14aec135.js";import{u as Ye,S as Xe,T as Je}from"./index-659952c0.js";import{S as Qe,a as et}from"./index-80ed7682.js";import{u as ye,L as tt,i as we,F as nt}from"./request-950452bd.js";import{m as at,u as lt,C as ot,B as st}from"./index-cd04c012.js";import{c as it,P as rt,N as ct}from"./index-c7bbf492.js";import{r as I,q as ut,d as E,a as z,c as s,s as V,v as ke,x as dt,y as q,z as ft,m as oe,A as mt,B as vt,C as bt,D as gt,g as ht,E as yt,G as wt,b as kt,w as P,u as _,i as Ct,o as St,k as fe,H as Bt}from"./index-a0915313.js";import{B as Tt,a as _t,r as pt,F as xt}from"./use-route-c3a680bb.js";import{u as J,o as It}from"./use-touch-a4d081dc.js";function Rt(e,a,i){let c=0;const l=e.scrollLeft,v=i===0?1:Math.round(i*1e3/16);function f(){e.scrollLeft+=(a-l)/v,++c<v&&te(f)}f()}function Pt(e,a,i,c){let l=$e(e);const v=l<a,f=i===0?1:Math.round(i*1e3/16),h=(a-l)/f;function u(){l+=h,(v&&l>a||!v&&l<a)&&(l=a),Ae(e,l),v&&l<a||!v&&l>a?te(u):c&&te(c)}u()}function Vt(){const e=I([]),a=[];return ut(()=>{e.value=[]}),[e,c=>(a[c]||(a[c]=l=>{e.value[c]=l}),a[c])]}const[Ot,me]=M("tab");var $t=E({name:Ot,props:{id:String,dot:Boolean,type:String,color:String,title:String,badge:O,shrink:Boolean,isActive:Boolean,disabled:Boolean,controls:String,scrollable:Boolean,activeColor:String,inactiveColor:String,showZeroBadge:F},setup(e,{slots:a}){const i=z(()=>{const l={},{type:v,color:f,disabled:h,isActive:u,activeColor:d,inactiveColor:w}=e;f&&v==="card"&&(l.borderColor=f,h||(u?l.backgroundColor=f:l.color=f));const y=u?d:w;return y&&(l.color=y),l}),c=()=>{const l=s("span",{class:me("text",{ellipsis:!e.scrollable})},[a.title?a.title():e.title]);return e.dot||X(e.badge)&&e.badge!==""?s(Ne,{dot:e.dot,content:e.badge,showZero:e.showZeroBadge},{default:()=>[l]}):l};return()=>s("div",{id:e.id,role:"tab",class:[me([e.type,{grow:e.scrollable&&!e.shrink,shrink:e.shrink,active:e.isActive,disabled:e.disabled}])],style:i.value,tabindex:e.disabled?void 0:e.isActive?0:-1,"aria-selected":e.isActive,"aria-disabled":e.disabled||void 0,"aria-controls":e.controls},[c()])}});const[At,ve]=M("tabs");var Nt=E({name:At,props:{count:Q(Number),inited:Boolean,animated:Boolean,duration:Q(O),swipeable:Boolean,lazyRender:Boolean,currentIndex:Q(Number)},emits:["change"],setup(e,{emit:a,slots:i}){const c=I(),l=h=>a("change",h),v=()=>{var h;const u=(h=i.default)==null?void 0:h.call(i);return e.animated||e.swipeable?s(Qe,{ref:c,loop:!1,class:ve("track"),duration:+e.duration*1e3,touchable:e.swipeable,lazyRender:e.lazyRender,showIndicators:!1,onChange:l},{default:()=>[u]}):u},f=h=>{const u=c.value;u&&u.state.active!==h&&u.swipeTo(h,{immediate:!e.inited})};return V(()=>e.currentIndex,f),ke(()=>{f(e.currentIndex)}),J({swipeRef:c}),()=>s("div",{class:ve("content",{animated:e.animated||e.swipeable})},[v()])}});const[Ce,G]=M("tabs"),zt={type:Y("line"),color:String,border:Boolean,sticky:Boolean,shrink:Boolean,active:Z(0),duration:Z(.3),animated:Boolean,ellipsis:F,swipeable:Boolean,scrollspy:Boolean,offsetTop:Z(0),background:String,lazyRender:F,lineWidth:O,lineHeight:O,beforeChange:Function,swipeThreshold:Z(5),titleActiveColor:String,titleInactiveColor:String},Se=Symbol(Ce);var Et=E({name:Ce,props:zt,emits:["change","scroll","rendered","clickTab","update:active"],setup(e,{emit:a,slots:i}){let c,l,v;const f=I(),h=I(),u=I(),d=I(),w=ye(),m=ze(f),[y,p]=Vt(),{children:b,linkChildren:R}=ge(Se),t=dt({inited:!1,position:"",lineStyle:{},currentIndex:-1}),o=z(()=>b.length>e.swipeThreshold||!e.ellipsis||e.shrink),k=z(()=>({borderColor:e.color,background:e.background})),C=(n,r)=>{var g;return(g=n.name)!=null?g:r},T=z(()=>{const n=b[t.currentIndex];if(n)return C(n,t.currentIndex)}),U=z(()=>Ee(e.offsetTop)),H=z(()=>e.sticky?U.value+c:0),A=n=>{const r=h.value,g=y.value;if(!o.value||!r||!g||!g[t.currentIndex])return;const B=g[t.currentIndex].$el,S=B.offsetLeft-(r.offsetWidth-B.offsetWidth)/2;Rt(r,S,n?0:+e.duration)},$=()=>{const n=t.inited;q(()=>{const r=y.value;if(!r||!r[t.currentIndex]||e.type!=="line"||Me(f.value))return;const g=r[t.currentIndex].$el,{lineWidth:B,lineHeight:S}=e,x=g.offsetLeft+g.offsetWidth/2,N={width:ce(B),backgroundColor:e.color,transform:`translateX(${x}px) translateX(-50%)`};if(n&&(N.transitionDuration=`${e.duration}s`),X(S)){const re=ce(S);N.height=re,N.borderRadius=re}t.lineStyle=N})},Be=n=>{const r=n<t.currentIndex?-1:1;for(;n>=0&&n<b.length;){if(!b[n].disabled)return n;n+=r}},W=(n,r)=>{const g=Be(n);if(!X(g))return;const B=b[g],S=C(B,g),x=t.currentIndex!==null;t.currentIndex!==g&&(t.currentIndex=g,r||A(),$()),S!==e.active&&(a("update:active",S),x&&a("change",S,B.title)),v&&!e.scrollspy&&Ue(Math.ceil(ue(f.value)-U.value))},j=(n,r)=>{const g=b.find((S,x)=>C(S,x)===n),B=g?b.indexOf(g):0;W(B,r)},se=(n=!1)=>{if(e.scrollspy){const r=b[t.currentIndex].$el;if(r&&m.value){const g=ue(r,m.value)-H.value;l=!0,Pt(m.value,g,n?0:+e.duration,()=>{l=!1})}}},Te=(n,r,g)=>{const{title:B,disabled:S}=b[r],x=C(b[r],r);S||(it(e.beforeChange,{args:[x],done:()=>{W(r),se()}}),_t(n)),a("clickTab",{name:x,title:B,event:g,disabled:S})},_e=n=>{v=n.isFixed,a("scroll",n)},pe=n=>{q(()=>{j(n),se(!0)})},xe=()=>{for(let n=0;n<b.length;n++){const{top:r}=de(b[n].$el);if(r>H.value)return n===0?0:n-1}return b.length-1},Ie=()=>{if(e.scrollspy&&!l){const n=xe();W(n)}},Re=()=>b.map((n,r)=>s($t,oe({key:n.id,id:`${w}-${r}`,ref:p(r),type:e.type,color:e.color,style:n.titleStyle,class:n.titleClass,shrink:e.shrink,isActive:r===t.currentIndex,controls:n.id,scrollable:o.value,activeColor:e.titleActiveColor,inactiveColor:e.titleInactiveColor,onClick:g=>Te(n,r,g)},he(n,["dot","badge","title","disabled","showZeroBadge"])),{title:n.$slots.title})),Pe=()=>{if(e.type==="line"&&b.length)return s("div",{class:G("line"),style:t.lineStyle},null)},ie=()=>{var n,r,g;const{type:B,border:S,sticky:x}=e,N=[s("div",{ref:x?void 0:u,class:[G("wrap"),{[Tt]:B==="line"&&S}]},[s("div",{ref:h,role:"tablist",class:G("nav",[B,{shrink:e.shrink,complete:o.value}]),style:k.value,"aria-orientation":"horizontal"},[(n=i["nav-left"])==null?void 0:n.call(i),Re(),Pe(),(r=i["nav-right"])==null?void 0:r.call(i)])]),(g=i["nav-bottom"])==null?void 0:g.call(i)];return x?s("div",{ref:u},[N]):N};V([()=>e.color,Le],$),V(()=>e.active,n=>{n!==T.value&&j(n)}),V(()=>b.length,()=>{t.inited&&(j(e.active),$(),q(()=>{A(!0)}))});const Ve=()=>{j(e.active,!0),q(()=>{t.inited=!0,u.value&&(c=de(u.value).height),A(!0)})},Oe=(n,r)=>a("rendered",n,r);return J({resize:()=>{$(),q(()=>{var n,r;return(r=(n=d.value)==null?void 0:n.swipeRef.value)==null?void 0:r.resize()})},scrollTo:pe}),ft($),It($),qe(Ve),Ye(f,$),Fe("scroll",Ie,{target:m,passive:!0}),R({id:w,props:e,setLine:$,onRendered:Oe,currentName:T,scrollIntoView:A}),()=>s("div",{ref:f,class:G([e.type])},[e.sticky?s(Xe,{container:f.value,offsetTop:U.value,onScroll:_e},{default:()=>[ie()]}):ie(),s(Nt,{ref:d,count:b.length,inited:t.inited,animated:e.animated,duration:e.duration,swipeable:e.swipeable,lazyRender:e.lazyRender,currentIndex:t.currentIndex,onChange:W},{default:()=>{var n;return[(n=i.default)==null?void 0:n.call(i)]}})])}});const[Lt,ee]=M("tab"),qt=ae({},pt,{dot:Boolean,name:O,badge:O,title:String,disabled:Boolean,titleClass:ne,titleStyle:[String,Object],showZeroBadge:F});var Ft=E({name:Lt,props:qt,setup(e,{slots:a}){const i=ye(),c=I(!1),{parent:l,index:v}=De(Se);if(!l)return;const f=()=>{var w;return(w=e.name)!=null?w:v.value},h=()=>{c.value=!0,l.props.lazyRender&&q(()=>{l.onRendered(f(),e.title)})},u=z(()=>{const w=f()===l.currentName.value;return w&&!c.value&&h(),w}),d=I(!u.value);return V(u,w=>{w?d.value=!1:He(()=>{d.value=!0})}),V(()=>e.title,()=>{l.setLine(),l.scrollIntoView()}),mt(Je,u),()=>{var w;const m=`${l.id}-${v.value}`,{animated:y,swipeable:p,scrollspy:b,lazyRender:R}=l.props;if(!a.default&&!y)return;const t=b||u.value;if(y||p)return s(et,{id:i,role:"tabpanel",class:ee("panel-wrapper",{inactive:d.value}),tabindex:u.value?0:-1,"aria-hidden":!u.value,"aria-labelledby":m},{default:()=>{var C;return[s("div",{class:ee("panel")},[(C=a.default)==null?void 0:C.call(a)])]}});const k=c.value||b||!R?(w=a.default)==null?void 0:w.call(a):null;return J({id:i}),vt(s("div",{id:i,role:"tabpanel",class:ee("panel"),tabindex:t?0:-1,"aria-labelledby":m},[k]),[[bt,t]])}}});const Mt=le(Ft),Ut=le(Et),[Dt,Ht]=M("form"),Wt={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:O,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:F,showErrorMessage:F,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var jt=E({name:Dt,props:Wt,emits:["submit","failed"],setup(e,{emit:a,slots:i}){const{children:c,linkChildren:l}=ge(xt),v=t=>t?c.filter(o=>t.includes(o.name)):c,f=t=>new Promise((o,k)=>{const C=[];v(t).reduce((U,H)=>U.then(()=>{if(!C.length)return H.validate().then(A=>{A&&C.push(A)})}),Promise.resolve()).then(()=>{C.length?k(C):o()})}),h=t=>new Promise((o,k)=>{const C=v(t);Promise.all(C.map(T=>T.validate())).then(T=>{T=T.filter(Boolean),T.length?k(T):o()})}),u=t=>{const o=c.find(k=>k.name===t);return o?new Promise((k,C)=>{o.validate().then(T=>{T?C(T):k()})}):Promise.reject()},d=t=>typeof t=="string"?u(t):e.validateFirst?f(t):h(t),w=t=>{typeof t=="string"&&(t=[t]),v(t).forEach(k=>{k.resetValidation()})},m=()=>c.reduce((t,o)=>(t[o.name]=o.getValidationStatus(),t),{}),y=(t,o)=>{c.some(k=>k.name===t?(k.$el.scrollIntoView(o),!0):!1)},p=()=>c.reduce((t,o)=>(o.name!==void 0&&(t[o.name]=o.formValue.value),t),{}),b=()=>{const t=p();d().then(()=>a("submit",t)).catch(o=>{a("failed",{values:t,errors:o}),e.scrollToError&&o[0].name&&y(o[0].name)})},R=t=>{We(t),b()};return l({props:e}),J({submit:b,validate:d,getValues:p,scrollToField:y,resetValidation:w,getValidationStatus:m}),()=>{var t;return s("form",{class:Ht(),onSubmit:R},[(t=i.default)==null?void 0:t.call(i)])}}});const Zt=le(jt);let D=0;function Gt(e){e?(D||document.body.classList.add("van-toast--unclickable"),D++):D&&(D--,D||document.body.classList.remove("van-toast--unclickable"))}const[Kt,L]=M("toast"),Yt=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay"],Xt={icon:String,show:Boolean,type:Y("text"),overlay:Boolean,message:O,iconSize:O,duration:je(2e3),position:Y("middle"),teleport:[String,Object],wordBreak:String,className:ne,iconPrefix:String,transition:Y("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:ne,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean};var Jt=E({name:Kt,props:Xt,emits:["update:show"],setup(e,{emit:a,slots:i}){let c,l=!1;const v=()=>{const m=e.show&&e.forbidClick;l!==m&&(l=m,Gt(l))},f=m=>a("update:show",m),h=()=>{e.closeOnClick&&f(!1)},u=()=>clearTimeout(c),d=()=>{const{icon:m,type:y,iconSize:p,iconPrefix:b,loadingType:R}=e;if(m||y==="success"||y==="fail")return s(Ze,{name:m||y,size:p,class:L("icon"),classPrefix:b},null);if(y==="loading")return s(tt,{class:L("loading"),size:p,type:R},null)},w=()=>{const{type:m,message:y}=e;if(i.message)return s("div",{class:L("text")},[i.message()]);if(X(y)&&y!=="")return m==="html"?s("div",{key:0,class:L("text"),innerHTML:String(y)},null):s("div",{class:L("text")},[y])};return V(()=>[e.show,e.forbidClick],v),V(()=>[e.show,e.type,e.message,e.duration],()=>{u(),e.show&&e.duration>0&&(c=setTimeout(()=>{f(!1)},e.duration))}),ke(v),gt(v),()=>s(rt,oe({class:[L([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:h,onClosed:u,"onUpdate:show":f},he(e,Yt)),{default:()=>[d(),w()]})}});const Qt={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let K=[],en=!1,be=ae({},Qt);const tn=new Map;function nn(e){return Ke(e)?e:{message:e}}function an(){const{instance:e,unmount:a}=at({setup(){const i=I(""),{open:c,state:l,close:v,toggle:f}=lt(),h=()=>{},u=()=>s(Jt,oe(l,{onClosed:h,"onUpdate:show":f}),null);return V(i,d=>{l.message=d}),ht().render=u,{open:c,close:v,message:i}}});return e}function ln(){if(!K.length||en){const e=an();K.push(e)}return K[K.length-1]}function on(e={}){if(!Ge)return{};const a=ln(),i=nn(e);return a.open(ae({},be,tn.get(i.type||be.type),i)),a}const sn=e=>we.post("/auth/login",e),rn=e=>we.post("/users",e),wn=E({__name:"Login",setup(e){const a=I({username:"",password:"",nickname:"",school:""}),i=async u=>{const d=await sn(u);Bt().$patch(m=>{m.token=d.token,m.user=d.user}),f()},c=async u=>{await rn(u),on("注册成功")},l=yt(),v=wt(),f=()=>{l.replace(v.query.origin)},h=I(0);return(u,d)=>{const w=ct,m=nt,y=ot,p=st,b=Zt,R=Mt,t=Ut;return St(),kt("div",null,[s(w,{title:"开启新大陆","left-text":"返回","left-arrow":"",onClickLeft:f}),s(t,{active:_(h),"onUpdate:active":d[6]||(d[6]=o=>Ct(h)?h.value=o:null)},{default:P(()=>[s(R,{title:"登录"},{default:P(()=>[s(b,{onSubmit:i},{default:P(()=>[s(y,{inset:""},{default:P(()=>[s(m,{modelValue:_(a).username,"onUpdate:modelValue":d[0]||(d[0]=o=>_(a).username=o),name:"username",label:"用户名",placeholder:"它是你的唯一凭证",rules:[{required:!0,message:"请填写用户名"}],required:""},null,8,["modelValue"]),s(m,{modelValue:_(a).password,"onUpdate:modelValue":d[1]||(d[1]=o=>_(a).password=o),type:"password",name:"password",label:"密码",placeholder:"你可以通过特殊手段找回它",rules:[{required:!0,message:"请填写密码"}],required:""},null,8,["modelValue"])]),_:1}),s(p,{round:"",block:"",type:"primary","native-type":"submit"},{default:P(()=>[fe(" 登录 ")]),_:1})]),_:1})]),_:1}),s(R,{title:"注册"},{default:P(()=>[s(b,{onSubmit:c},{default:P(()=>[s(y,{inset:""},{default:P(()=>[s(m,{modelValue:_(a).username,"onUpdate:modelValue":d[2]||(d[2]=o=>_(a).username=o),name:"username",label:"用户名",placeholder:"它是你的唯一凭证",rules:[{required:!0,message:"请填写用户名"}],required:""},null,8,["modelValue"]),s(m,{modelValue:_(a).password,"onUpdate:modelValue":d[3]||(d[3]=o=>_(a).password=o),type:"password",name:"password",label:"密码",placeholder:"你可以通过特殊手段找回它",rules:[{required:!0,message:"请填写密码"}],required:""},null,8,["modelValue"]),s(m,{modelValue:_(a).nickname,"onUpdate:modelValue":d[4]||(d[4]=o=>_(a).nickname=o),name:"nickname",label:"昵称",placeholder:"取个好听的外号吧",rules:[{message:"请填写昵称"}]},null,8,["modelValue"]),s(m,{modelValue:_(a).school,"onUpdate:modelValue":d[5]||(d[5]=o=>_(a).school=o),name:"school",label:"学校",placeholder:"我无从校验，请您确保它的真实性",rules:[{message:"请填写所属学校"}]},null,8,["modelValue"])]),_:1}),s(p,{round:"",block:"",type:"primary","native-type":"submit"},{default:P(()=>[fe(" 注册 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["active"])])}}});export{wn as default};
