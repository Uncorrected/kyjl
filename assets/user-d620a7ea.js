import{c as ee,j as X,n as Q,q as Ce,E as G,H as N,t as U,J as ie,a as B,u as ae,m as Z,o as xe,K as Se,A as M,C as Ie,I as $,G as _e,e as q,w as re,L as ce,M as ke,N as ue,h as ze,O as Re,P as Te}from"./index-14aec135.js";import{S as Fe}from"./index-87faba9c.js";import{L as de,i as me,C as De,F as Ve}from"./request-950452bd.js";import{m as Ae,u as Ue,B as Le,C as Be}from"./index-cd04c012.js";import{I as ve}from"./index-273486c6.js";/* empty css              */import{a as Ze,S as $e}from"./index-80ed7682.js";import{P as fe,c as ge,N as Ee}from"./index-c7bbf492.js";import{d as H,x as te,r as E,a as O,s as Y,c as n,v as Ne,y as Oe,m as oe,I as Xe,B as Me,C as Ye,E as He,H as We,b as je,w as D,u as A,i as ne,F as qe,o as Ge,k as K}from"./index-a0915313.js";import{a as Ke,u as he}from"./use-touch-a4d081dc.js";import{L as Je,H as Qe}from"./use-route-c3a680bb.js";const le=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),J=ee("image-preview")[1];var et=H({props:{src:String,show:Boolean,active:Number,minZoom:X(Q),maxZoom:X(Q),rootWidth:X(Number),rootHeight:X(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:l,slots:r}){const t=te({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=Ke(),b=E(),y=O(()=>{const{rootWidth:a,rootHeight:f}=e,g=f/a;return t.imageRatio>g}),S=O(()=>{const{scale:a,moveX:f,moveY:g,moving:k,zooming:V}=t,W={transitionDuration:V||k?"0s":".3s"};if(a!==1){const ye=f/a,Pe=g/a;W.transform=`scale(${a}, ${a}) translate(${ye}px, ${Pe}px)`}return W}),m=O(()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:f}=e,g=y.value?f/t.imageRatio:a;return Math.max(0,(t.scale*g-a)/2)}return 0}),c=O(()=>{if(t.imageRatio){const{rootWidth:a,rootHeight:f}=e,g=y.value?f:a*t.imageRatio;return Math.max(0,(t.scale*g-f)/2)}return 0}),v=a=>{a=N(a,+e.minZoom,+e.maxZoom+1),a!==t.scale&&(t.scale=a,l("scale",{scale:a,index:e.active}))},d=()=>{v(1),t.moveX=0,t.moveY=0},w=()=>{const a=t.scale>1?1:2;v(a),t.moveX=0,t.moveY=0};let x,I,z,T,R,u,C,o=!1;const i=a=>{const{touches:f}=a;if(x=f.length,x===2&&e.disableZoom)return;const{offsetX:g}=s;s.start(a),I=t.moveX,z=t.moveY,C=Date.now(),o=!1,t.moving=x===1&&t.scale!==1,t.zooming=x===2&&!g.value,t.zooming&&(T=t.scale,R=le(a.touches))},P=a=>{const{touches:f}=a;if(s.move(a),t.moving){const{deltaX:g,deltaY:k}=s,V=g.value+I,W=k.value+z;if((V>m.value||V<-m.value)&&!o){t.moving=!1;return}o=!0,G(a,!0),t.moveX=N(V,-m.value,m.value),t.moveY=N(W,-c.value,c.value)}if(t.zooming&&(G(a,!0),f.length===2)){const g=le(f),k=T*g/R;v(k)}},p=()=>{if(x>1)return;const{offsetX:a,offsetY:f}=s,g=Date.now()-C,k=250,V=5;a.value<V&&f.value<V&&(g<k?u?(clearTimeout(u),u=null,w()):u=setTimeout(()=>{l("close"),u=null},k):g>Je&&l("longPress"))},_=a=>{let f=!1;(t.moving||t.zooming)&&(f=!0,t.moving&&I===t.moveX&&z===t.moveY&&(f=!1),a.touches.length||(t.zooming&&(t.moveX=N(t.moveX,-m.value,m.value),t.moveY=N(t.moveY,-c.value,c.value),t.zooming=!1),t.moving=!1,I=0,z=0,T=1,t.scale<1&&d(),t.scale>e.maxZoom&&(t.scale=+e.maxZoom))),G(a,f),p(),s.reset()},F=a=>{const{naturalWidth:f,naturalHeight:g}=a.target;t.imageRatio=g/f};return Y(()=>e.active,d),Y(()=>e.show,a=>{a||d()}),Ce("touchmove",P,{target:O(()=>{var a;return(a=b.value)==null?void 0:a.$el})}),()=>{const a={loading:()=>n(de,{type:"spinner"},null)};return n(Ze,{ref:b,class:J("swipe-item"),onTouchstartPassive:i,onTouchend:_,onTouchcancel:_},{default:()=>[r.image?n("div",{class:J("image-wrap")},[r.image({src:e.src})]):n(ve,{src:e.src,fit:"contain",class:J("image",{vertical:y.value}),style:S.value,onLoad:F},a)]})}}});const[tt,L]=ee("image-preview"),ot=["show","teleport","transition","overlayStyle","closeOnPopstate"],at={show:Boolean,loop:U,images:ie(),minZoom:B(1/3),maxZoom:B(3),overlay:U,closeable:Boolean,showIndex:U,className:ae,closeIcon:Z("clear"),transition:String,beforeClose:Function,overlayClass:ae,overlayStyle:Object,swipeDuration:B(300),startPosition:B(0),showIndicators:Boolean,closeOnPopstate:U,closeIconPosition:Z("top-right"),teleport:[String,Object]};var we=H({name:tt,props:at,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:l,slots:r}){const t=E(),s=te({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),b=()=>{if(t.value){const u=Ie(t.value.$el);s.rootWidth=u.width,s.rootHeight=u.height,t.value.resize()}},y=u=>l("scale",u),S=u=>l("update:show",u),m=()=>{ge(e.beforeClose,{args:[s.active],done:()=>S(!1)})},c=u=>{u!==s.active&&(s.active=u,l("change",u))},v=()=>{if(e.showIndex)return n("div",{class:L("index")},[r.index?r.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},d=()=>{if(r.cover)return n("div",{class:L("cover")},[r.cover()])},w=()=>{s.disableZoom=!0},x=()=>{s.disableZoom=!1},I=()=>n($e,{ref:t,lazyRender:!0,loop:e.loop,class:L("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:c,onDragEnd:x,onDragStart:w},{default:()=>[e.images.map((u,C)=>n(et,{src:u,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:y,onClose:m,onLongPress:()=>l("longPress",{index:C})},{image:r.image}))]}),z=()=>{if(e.closeable)return n($,{role:"button",name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),Qe],onClick:m},null)},T=()=>l("closed"),R=(u,C)=>{var o;return(o=t.value)==null?void 0:o.swipeTo(u,C)};return he({swipeTo:R}),Ne(b),Y([xe,Se],b),Y(()=>e.startPosition,u=>c(+u)),Y(()=>e.show,u=>{const{images:C,startPosition:o}=e;u?(c(+o),Oe(()=>{b(),R(+o,{immediate:!0})})):l("close",{index:s.active,url:C[s.active]})}),()=>n(fe,oe({class:[L(),e.className],overlayClass:[L("overlay"),e.overlayClass],onClosed:T,"onUpdate:show":S},M(e,ot)),{default:()=>[z(),I(),v(),d()]})}});let j;const nt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function lt(){({instance:j}=Ae({setup(){const{state:e,toggle:l}=Ue(),r=()=>{e.images=[]};return()=>n(we,oe(e,{onClosed:r,"onUpdate:show":l}),null)}}))}const st=(e,l=0)=>{if(_e)return j||lt(),e=Array.isArray(e)?{images:e,startPosition:l}:e,j.open(q({},nt,e)),j};re(we);const[it,h,rt]=ee("uploader");function se(e,l){return new Promise(r=>{if(l==="file"){r();return}const t=new FileReader;t.onload=s=>{r(s.target.result)},l==="dataUrl"?t.readAsDataURL(e):l==="text"&&t.readAsText(e)})}function pe(e,l){return ce(e).some(r=>r.file?ke(l)?l(r.file):r.file.size>l:!1)}function ct(e,l){const r=[],t=[];return e.forEach(s=>{pe(s,l)?t.push(s):r.push(s)}),{valid:r,invalid:t}}const ut=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i,dt=e=>ut.test(e);function be(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?dt(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var mt=H({props:{name:Q,item:X(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:l,slots:r}){const t=()=>{const{status:c,message:v}=e.item;if(c==="uploading"||c==="failed"){const d=c==="failed"?n($,{name:"close",class:h("mask-icon")},null):n(de,{class:h("loading")},null),w=ze(v)&&v!=="";return n("div",{class:h("mask")},[d,w&&n("div",{class:h("mask-message")},[v])])}},s=c=>{const{name:v,item:d,index:w,beforeDelete:x}=e;c.stopPropagation(),ge(x,{args:[d,{name:v,index:w}],done:()=>l("delete")})},b=()=>l("preview"),y=()=>{if(e.deletable&&e.item.status!=="uploading"){const c=r["preview-delete"];return n("div",{role:"button",class:h("preview-delete",{shadow:!c}),tabindex:0,"aria-label":rt("delete"),onClick:s},[c?c():n($,{name:"cross",class:h("preview-delete-icon")},null)])}},S=()=>{if(r["preview-cover"]){const{index:c,item:v}=e;return n("div",{class:h("preview-cover")},[r["preview-cover"](q({index:c},v))])}},m=()=>{const{item:c,lazyLoad:v,imageFit:d,previewSize:w}=e;return be(c)?n(ve,{fit:d,src:c.content||c.url,class:h("preview-image"),width:Array.isArray(w)?w[0]:w,height:Array.isArray(w)?w[1]:w,lazyLoad:v,onClick:b},{default:S}):n("div",{class:h("file"),style:ue(e.previewSize)},[n($,{class:h("file-icon"),name:"description"},null),n("div",{class:[h("file-name"),"van-ellipsis"]},[c.file?c.file.name:c.url]),S()])};return()=>n("div",{class:h("preview")},[m(),t(),y()])}});const vt={name:B(""),accept:Z("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:B(1/0),imageFit:Z("cover"),resultType:Z("dataUrl"),uploadIcon:Z("photograph"),uploadText:String,deletable:U,afterRead:Function,showUpload:U,modelValue:ie(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:U,previewOptions:Object,previewFullImage:U,maxSize:{type:[Number,String,Function],default:1/0}};var ft=H({name:it,props:vt,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:l,slots:r}){const t=E(),s=[],b=(o=e.modelValue.length)=>({name:e.name,index:o}),y=()=>{t.value&&(t.value.value="")},S=o=>{if(y(),pe(o,e.maxSize))if(Array.isArray(o)){const i=ct(o,e.maxSize);if(o=i.valid,l("oversize",i.invalid,b()),!o.length)return}else{l("oversize",o,b());return}o=te(o),l("update:modelValue",[...e.modelValue,...ce(o)]),e.afterRead&&e.afterRead(o,b())},m=o=>{const{maxCount:i,modelValue:P,resultType:p}=e;if(Array.isArray(o)){const _=+i-P.length;o.length>_&&(o=o.slice(0,_)),Promise.all(o.map(F=>se(F,p))).then(F=>{const a=o.map((f,g)=>{const k={file:f,status:"",message:""};return F[g]&&(k.content=F[g]),k});S(a)})}else se(o,p).then(_=>{const F={file:o,status:"",message:""};_&&(F.content=_),S(F)})},c=o=>{const{files:i}=o.target;if(e.disabled||!i||!i.length)return;const P=i.length===1?i[0]:[].slice.call(i);if(e.beforeRead){const p=e.beforeRead(P,b());if(!p){y();return}if(Te(p)){p.then(_=>{m(_||P)}).catch(y);return}}m(P)};let v;const d=()=>l("closePreview"),w=o=>{if(e.previewFullImage){const i=e.modelValue.filter(be),P=i.map(p=>(p.file&&!p.url&&p.status!=="failed"&&(p.url=URL.createObjectURL(p.file),s.push(p.url)),p.url)).filter(Boolean);v=st(q({images:P,startPosition:i.indexOf(o),onClose:d},e.previewOptions))}},x=()=>{v&&v.close()},I=(o,i)=>{const P=e.modelValue.slice(0);P.splice(i,1),l("update:modelValue",P),l("delete",o,b(i))},z=(o,i)=>{const P=["imageFit","deletable","previewSize","beforeDelete"],p=q(M(e,P),M(o,P,!0));return n(mt,oe({item:o,index:i,onClick:()=>l("clickPreview",o,b(i)),onDelete:()=>I(o,i),onPreview:()=>w(o)},M(e,["name","lazyLoad"]),p),M(r,["preview-cover","preview-delete"]))},T=()=>{if(e.previewImage)return e.modelValue.map(z)},R=o=>l("clickUpload",o),u=()=>{if(e.modelValue.length>=e.maxCount)return;const o=e.readonly?null:n("input",{ref:t,type:"file",class:h("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:c},null);return r.default?n("div",{class:h("input-wrapper"),onClick:R},[r.default(),o]):Me(n("div",{class:h("upload",{readonly:e.readonly}),style:ue(e.previewSize),onClick:R},[n($,{name:e.uploadIcon,class:h("upload-icon")},null),e.uploadText&&n("span",{class:h("upload-text")},[e.uploadText]),o]),[[Ye,e.showUpload]])},C=()=>{t.value&&!e.disabled&&t.value.click()};return Xe(()=>{s.forEach(o=>URL.revokeObjectURL(o))}),he({chooseFile:C,closeImagePreview:x}),Re(()=>e.modelValue),()=>n("div",{class:h()},[n("div",{class:h("wrapper",{disabled:e.disabled})},[T(),u()])])}});const gt=re(ft);const ht={user:"/users"},wt=(e,l="")=>me.patch(`${ht.user}/${l}`,e),pt={timeout:0,headers:{"Content-Type":"multipart/form-data"}},bt=e=>me.post("/upload/image",e,pt),Ft=H({__name:"user",setup(e){const l=He(),r=()=>{l.back()},t=E(!1),s=We(),b=()=>{s.$reset(),r()},y=E([{url:s.user.avatar}]),S=async v=>{const d=await bt(v);s.user.avatar=d},m=E({...s.user}),c=async()=>{await wt(m.value),s.$patch(v=>{Object.assign(v.user,m.value)}),r()};return(v,d)=>{const w=$,x=Ee,I=Le,z=fe,T=gt,R=De,u=Be,C=Ve,o=Fe;return Ge(),je(qe,null,[n(x,{title:"个人中心","left-text":"返回","left-arrow":"",onClickLeft:r,onClickRight:d[0]||(d[0]=i=>t.value=!0)},{right:D(()=>[n(w,{name:"ellipsis"})]),_:1}),n(z,{show:A(t),"onUpdate:show":d[1]||(d[1]=i=>ne(t)?t.value=i:null),position:"bottom"},{default:D(()=>[n(I,{type:"default",square:"",block:"",hairline:""},{default:D(()=>[K("重置密码")]),_:1}),n(I,{type:"default",square:"",block:"",hairline:"",onClick:b},{default:D(()=>[K("退出登录")]),_:1})]),_:1},8,["show"]),n(o,{direction:"vertical",fill:"",size:"24px"},{default:D(()=>[n(u,null,{default:D(()=>[n(R,{center:"",title:"头像",clickable:""},{"right-icon":D(()=>[n(T,{"after-read":S,"preview-size":"6rem","preview-full-image":!1,modelValue:A(y),"onUpdate:modelValue":d[2]||(d[2]=i=>ne(y)?y.value=i:null),"max-count":1},null,8,["modelValue"])]),_:1})]),_:1}),n(u,null,{default:D(()=>[n(C,{label:"用户名",modelValue:A(m).username,"onUpdate:modelValue":d[3]||(d[3]=i=>A(m).username=i),placeholder:"请不要这样做，这会破坏系统完整性"},null,8,["modelValue"]),n(C,{label:"昵称",modelValue:A(m).nickname,"onUpdate:modelValue":d[4]||(d[4]=i=>A(m).nickname=i),placeholder:"我该怎么称呼您"},null,8,["modelValue"]),n(C,{label:"学校",modelValue:A(m).school,"onUpdate:modelValue":d[5]||(d[5]=i=>A(m).school=i),placeholder:"请输入高校名称"},null,8,["modelValue"])]),_:1}),n(I,{type:"primary",size:"small",block:"",onClick:c},{default:D(()=>[K("保存信息")]),_:1})]),_:1})],64)}}});export{Ft as default};
